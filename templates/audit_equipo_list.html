{% extends "base.html" %} {% block title %}Auditoría — {{ e.codigo_interno }}{%
endblock %} {% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3 class="m-0">Auditoría de equipo</h3>
  <a
    class="btn btn-outline-secondary"
    href="{{ url_for('equipos_show', equipo_id=e.id) }}"
    >Volver al equipo</a
  >
</div>

<div class="mb-3">
  <div><strong>Código interno:</strong> {{ e.codigo_interno }}</div>
  <div><strong>Serial:</strong> {{ e.serial or '—' }}</div>
  <div>
    <strong>Estado actual:</strong>
    <span class="badge text-bg-secondary">{{ e.estado }}</span>
  </div>
</div>

<div class="card shadow-sm animate-fade-in">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-modern align-middle m-0">
        <thead>
          <tr>
            <th>#</th>
            <th>Fecha</th>
            <th>Acción</th>
            <th>Actor</th>
            <th>Detalle</th>
            <th>IP</th>
          </tr>
        </thead>
        <tbody>
          {% for a in audits %}
          <tr>
            <td><code class="user-select-all">{{ a.id }}</code></td>
            <td>
              <small>{{ a.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</small>
            </td>

            {# Colores de badge por tipo de acción #} {% set badge_class =
            'text-bg-secondary' %} {% if a.action == 'equipo_create' %} {% set
            badge_class = 'text-bg-success' %} {% elif a.action ==
            'equipo_update' %} {% set badge_class = 'text-bg-warning' %} {% elif
            a.action == 'equipo_delete' %} {% set badge_class = 'text-bg-danger'
            %} {% endif %}
            <td><span class="badge {{ badge_class }}">{{ a.action }}</span></td>

            <td>
              {{ a.actor.username if a.actor and a.actor.username else '—' }}
            </td>
            <td class="small">{{ a.detail|render_audit_detail }}</td>
            <td>
              <small class="text-muted" title="{{ a.user_agent or '' }}">
                {{ a.ip or '—' }}
              </small>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="6" class="text-center py-4 text-muted">
              Sin eventos registrados.
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Paginación -->
  {% if total > size %}
  <div class="card-footer bg-light">
    <div class="d-flex justify-content-between align-items-center">
      <small class="text-muted">
        Mostrando {{ ((page-1)*size + 1) }} - {{ [page*size, total]|min }} de {{
        total }} eventos
      </small>
      <nav>
        <ul class="pagination pagination-sm mb-0">
          {% if page > 1 %}
          <li class="page-item">
            <a
              class="page-link"
              href="{{ url_for('audit_equipo_show', equipo_id=e.id, page=page-1, size=size) }}"
              >Anterior</a
            >
          </li>
          {% endif %} {% for p in range(1, (total // size) + 2) %} {% if p ==
          page %}
          <li class="page-item active">
            <span class="page-link">{{ p }}</span>
          </li>
          {% elif p <= (total // size) + 1 %}
          <li class="page-item">
            <a
              class="page-link"
              href="{{ url_for('audit_equipo_show', equipo_id=e.id, page=p, size=size) }}"
              >{{ p }}</a
            >
          </li>
          {% endif %} {% endfor %} {% if page < (total // size) + 1 %}
          <li class="page-item">
            <a
              class="page-link"
              href="{{ url_for('audit_equipo_show', equipo_id=e.id, page=page+1, size=size) }}"
              >Siguiente</a
            >
          </li>
          {% endif %}
        </ul>
      </nav>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
