{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="row g-4">
  <!-- Tarjeta de bienvenida -->
  <div class="col-12">
    <div class="card shadow-sm border-0">
      <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3">
        <div>
          <h3 class="mb-1">
          <span class="d-inline-flex align-items-center justify-content-center bg-primary text-white rounded-circle me-2" style="width: 34px; height: 34px;">
          <i class="bi bi-person-fill"></i>
          </span>
          Hola, {{ data.nombre }}
          </h3>

          <p class="mb-2 text-muted">
            Bienvenido al sistema PDS-006. Tu correo registrado es
            <strong>{{ data.correo }}</strong>.
          </p>
          <span class="badge rounded-pill
                       {% if current_user.role == 'admin' %}bg-danger-subtle text-danger-emphasis border border-danger-subtle
                       {% else %}bg-primary-subtle text-primary-emphasis border border-primary-subtle{% endif %}">
            <i class="bi bi-person-badge me-1"></i>
            Rol: {{ current_user.role|capitalize }}
          </span>
        </div>

        <div class="text-muted small text-md-end">
          <div class="fw-semibold">
            <i class="bi bi-shield-lock me-1"></i>Acceso seguro
          </div>
          <div>Sesión protegida con autenticación y auditoría.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Accesos rápidos -->
  <div class="col-12 col-lg-8">
    <div class="card shadow-sm border-0 h-100">
      <div class="card-header bg-transparent border-0 pb-0">
        <h5 class="card-title mb-1">
          <i class="bi bi-lightning-charge me-1"></i> Accesos rápidos
        </h5>
        <p class="text-muted small mb-3">
          Navega rápidamente a las secciones más usadas según tu rol.
        </p>
      </div>
      <div class="card-body">
        <div class="row g-3">

          <!-- Siempre visibles -->
          <div class="col-12 col-md-6">
            <a href="{{ url_for('equipos_index') }}"
               class="btn btn-outline-primary w-100 text-start d-flex align-items-center gap-2 py-3">
              <i class="bi bi-pc-display fs-4"></i>
              <div>
                <div class="fw-semibold">Equipos</div>
                <div class="small text-muted">
                  Consulta el listado de equipos registrados.
                </div>
              </div>
            </a>
          </div>

          <!-- Acceso rápido a Reportes -->
          <div class="col-12 col-md-6">
            <a href="{{ url_for('reportes') }}"
               class="btn btn-outline-success w-100 text-start d-flex align-items-center gap-2 py-3">
              <i class="bi bi-graph-up-arrow fs-4"></i>
              <div>
                <div class="fw-semibold">Reportes</div>
                <div class="small text-muted">
                  Genera reportes y exporta información de equipos.
                </div>
              </div>
            </a>
          </div>

          <div class="col-12 col-md-6">
            <a href="{{ url_for('perfil') }}"
               class="btn btn-outline-secondary w-100 text-start d-flex align-items-center gap-2 py-3">
              <i class="bi bi-person-circle fs-4"></i>
              <div>
                <div class="fw-semibold">Mi perfil</div>
                <div class="small text-muted">
                  Revisa tu información y configuración básica.
                </div>
              </div>
            </a>
          </div>

          <div class="col-12 col-md-6">
            <a href="{{ url_for('empresas_index') }}"
               class="btn btn-outline-success w-100 text-start d-flex align-items-center gap-2 py-3">
              <i class="bi bi-buildings fs-4"></i>
              <div>
                <div class="fw-semibold">Empresas externas</div>
                <div class="small text-muted">
                  Visualiza el catálogo de empresas registradas.
                </div>
              </div>
            </a>
          </div>

          <div class="col-12 col-md-6">
            <a href="{{ url_for('responsables_index') }}"
               class="btn btn-outline-info w-100 text-start d-flex align-items-center gap-2 py-3">
              <i class="bi bi-people fs-4"></i>
              <div>
                <div class="fw-semibold">Responsables de entrega</div>
                <div class="small text-muted">
                  Consulta los responsables asociados a las empresas.
                </div>
              </div>
            </a>
          </div>

          <!-- Solo ADMIN -->
          {% if current_user.role == 'admin' %}
          <div class="col-12">
            <hr class="my-2">
            <p class="text-muted small mb-2">
              <i class="bi bi-tools me-1"></i> Opciones avanzadas para administradores
            </p>
          </div>

          <div class="col-12 col-md-6">
            <a href="{{ url_for('equipos_create') }}"
               class="btn btn-outline-primary w-100 text-start d-flex align-items-center gap-2 py-3">
              <i class="bi bi-plus-circle fs-4"></i>
              <div>
                <div class="fw-semibold">Nuevo equipo</div>
                <div class="small text-muted">
                  Registra el ingreso de un nuevo equipo externo.
                </div>
              </div>
            </a>
          </div>

          <div class="col-12 col-md-6">
            <a href="{{ url_for('users_index') }}"
               class="btn btn-outline-secondary w-100 text-start d-flex align-items-center gap-2 py-3">
              <i class="bi bi-people-gear fs-4"></i>
              <div>
                <div class="fw-semibold">Gestión de usuarios</div>
                <div class="small text-muted">
                  Administra cuentas, roles y accesos del sistema.
                </div>
              </div>
            </a>
          </div>

          <div class="col-12 col-md-6">
            <a href="{{ url_for('audit_equipos_admin') }}"
               class="btn btn-outline-warning w-100 text-start d-flex align-items-center gap-2 py-3">
              <i class="bi bi-clipboard-data fs-4"></i>
              <div>
                <div class="fw-semibold">Auditoría de equipos</div>
                <div class="small text-muted">
                  Revisa el historial de cambios sobre los equipos.
                </div>
              </div>
            </a>
          </div>

          <div class="col-12 col-md-6">
            <a href="{{ url_for('audit_admin') }}"
               class="btn btn-outline-danger w-100 text-start d-flex align-items-center gap-2 py-3">
              <i class="bi bi-activity fs-4"></i>
              <div>
                <div class="fw-semibold">Auditoría de usuarios</div>
                <div class="small text-muted">
                  Consulta actividades relevantes de las cuentas.
                </div>
              </div>
            </a>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Panel lateral: info / tips -->
  <div class="col-12 col-lg-4">
    <div class="card shadow-sm border-0 mb-3">
      <div class="card-body">
        <h6 class="fw-semibold mb-2">
          <i class="bi bi-bell me-1"></i> Notificaciones
        </h6>
        <p class="small text-muted mb-1">
          Usa la campana en la parte superior derecha para ver avisos de:
        </p>
        <ul class="small text-muted mb-0">
          <li>Asignación como “Autorizado por” en un equipo.</li>
          <li>Cambios de estado de equipos que administras.</li>
          <li>Actualizaciones de tu perfil o rol.</li>
        </ul>
      </div>
    </div>

    <div class="card shadow-sm border-0">
      <div class="card-body">
        <h6 class="fw-semibold mb-2">
          <i class="bi bi-shield-check me-1"></i> Buenas prácticas
        </h6>
        <ul class="small text-muted mb-0">
          <li>Cierra sesión cuando termines de usar el sistema.</li>
          <li>No compartas tus credenciales con otras personas.</li>
          <li>Verifica siempre la información antes de aprobar un equipo.</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Métricas de equipos -->
<div class="col-12 mt-2">
  <div class="card shadow-sm border-0">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h6 class="text-muted mb-0">
          <i class="bi bi-bar-chart-line me-1"></i>
          Resumen de equipos
        </h6>
        <span class="small text-muted">
          Total registrados:
          <span class="fw-semibold">{{ metrics.total }}</span>
        </span>
      </div>

      <div class="row g-3">
        <!-- Pendientes -->
        <div class="col-6 col-md-3">
          <div class="card border-0 shadow-sm h-100 bg-light-subtle">
            <div class="card-body py-3">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <div class="small text-muted">Pendientes</div>
                  <div class="fs-4 fw-semibold text-warning">
                    {{ metrics.por_estado.pendiente }}
                  </div>
                </div>
                <i class="bi bi-hourglass-split fs-3 text-warning"></i>
              </div>
            </div>
          </div>
        </div>

        <!-- En revisión -->
        <div class="col-6 col-md-3">
          <div class="card border-0 shadow-sm h-100 bg-light-subtle">
            <div class="card-body py-3">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <div class="small text-muted">En revisión</div>
                  <div class="fs-4 fw-semibold text-info">
                    {{ metrics.por_estado.en_revision }}
                  </div>
                </div>
                <i class="bi bi-search fs-3 text-info"></i>
              </div>
            </div>
          </div>
        </div>

        <!-- Aprobados -->
        <div class="col-6 col-md-3">
          <div class="card border-0 shadow-sm h-100 bg-light-subtle">
            <div class="card-body py-3">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <div class="small text-muted">Aprobados</div>
                  <div class="fs-4 fw-semibold text-success">
                    {{ metrics.por_estado.aprobado }}
                  </div>
                </div>
                <i class="bi bi-check-circle fs-3 text-success"></i>
              </div>
            </div>
          </div>
        </div>

        <!-- Devueltos -->
        <div class="col-6 col-md-3">
          <div class="card border-0 shadow-sm h-100 bg-light-subtle">
            <div class="card-body py-3">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <div class="small text-muted">Devueltos</div>
                  <div class="fs-4 fw-semibold text-danger">
                    {{ metrics.por_estado.devuelto }}
                  </div>
                </div>
                <i class="bi bi-arrow-return-left fs-3 text-danger"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


</div>  {# <- cierre del row g-4 #}
{% endblock %}
